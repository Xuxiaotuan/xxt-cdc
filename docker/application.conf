# MySQL CDC Service 配置文件

# CDC 配置
cdc {
  # 源数据库配置
  source {
    host = ${?CDC_SOURCE_HOST:"100.82.226.63"}
    port = ${?CDC_SOURCE_PORT:31765}
    username = ${?CDC_SOURCE_USERNAME:"root"}
    password = ${?CDC_SOURCE_PASSWORD:"asd123456"}
    database = ${?CDC_SOURCE_DATABASE:"test"}
    
    connection-pool {
      max-pool-size = ${?CDC_SOURCE_MAX_POOL_SIZE:10}
      min-idle = ${?CDC_SOURCE_MIN_IDLE:2}
      connection-timeout = "30s"
    }
  }
  
  # 目标数据库配置
  target {
    host = ${?CDC_TARGET_HOST:"100.82.226.63"}
    port = ${?CDC_TARGET_PORT:31765}
    username = ${?CDC_TARGET_USERNAME:"root"}
    password = ${?CDC_TARGET_PASSWORD:"asd123456"}
    database = ${?CDC_TARGET_DATABASE:"test_target"}
    
    connection-pool {
      max-pool-size = ${?CDC_TARGET_MAX_POOL_SIZE:20}
      min-idle = ${?CDC_TARGET_MIN_IDLE:5}
      connection-timeout = "30s"
    }
  }
  
  # 表过滤配置
  filter {
    include-databases = ${?CDC_INCLUDE_DATABASES:[]}
    exclude-databases = ${?CDC_EXCLUDE_DATABASES:["information_schema", "mysql", "performance_schema", "sys"]}
    include-table-patterns = ${?CDC_INCLUDE_TABLE_PATTERNS:[]}
    exclude-table-patterns = ${?CDC_EXCLUDE_TABLE_PATTERNS:[]}
  }
  
  # 并行度配置
  parallelism {
    partition-count = ${?CDC_PARTITION_COUNT:64}
    apply-worker-count = ${?CDC_APPLY_WORKER_COUNT:8}
    snapshot-worker-count = ${?CDC_SNAPSHOT_WORKER_COUNT:4}
    batch-size = ${?CDC_BATCH_SIZE:100}
    flush-interval = ${?CDC_FLUSH_INTERVAL:"1s"}
  }
  
  # 偏移量配置
  offset {
    store-type = ${?CDC_OFFSET_STORE_TYPE:"mysql"}  # mysql 或 file
    commit-interval = ${?CDC_OFFSET_COMMIT_INTERVAL:"5s"}
    
    # MySQL 存储配置
    mysql {
      table-name = ${?CDC_OFFSET_TABLE_NAME:"cdc_offsets"}
    }
    
    # 文件存储配置
    file {
      path = ${?CDC_OFFSET_FILE_PATH:"./data/offsets"}
    }
  }
}

# Pekko 配置
pekko {
  loglevel = ${?PEKKO_LOG_LEVEL:"INFO"}
  
  actor {
    provider = "local"
  }
  
  stream {
    materializer {
      max-input-buffer-size = 256
      initial-input-buffer-size = 4
    }
  }
}
