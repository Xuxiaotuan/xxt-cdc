# MySQL CDC 引擎默认配置

cdc {
  # CDC 任务名称，用于区分不同的 CDC 任务
  # 多个任务可以共享同一个元数据库，通过 task-name 区分
  task-name = "default-cdc-task"

  # 源数据库配置
  source {
    host = "100.82.226.63"
    port = 31765
    username = "root"
    password = "asd123456"
    database = "test"

    connection-pool {
      max-pool-size = 10
      min-idle = 2
      connection-timeout = 30s
    }
  }

  # 目标数据库配置
  target {
    host = "100.82.226.63"
    port = 31765
    username = "root"
    password = "asd123456"
    database = "test_target"

    connection-pool {
      max-pool-size = 20
      min-idle = 5
      connection-timeout = 30s
    }
  }

  # 元数据库配置
  # 用于存储 CDC 偏移量等元数据，与业务数据分离
  # 多个 CDC 任务可以共享同一个元数据库
  metadata {
    host = "100.82.226.63"
    port = 31765
    username = "root"
    password = "asd123456"
    database = "xxt_cdc"

    connection-pool {
      max-pool-size = 5
      min-idle = 1
      connection-timeout = 30s
    }
  }

  # 表过滤配置
  filter {
    include-databases = []
    exclude-databases = ["information_schema", "mysql", "performance_schema", "sys"]
    include-table-patterns = []
    exclude-table-patterns = []
  }

  # 并行度配置
  parallelism {
    partition-count = 64
    apply-worker-count = 8
    snapshot-worker-count = 4
    batch-size = 100
    flush-interval = 1s
  }

  # 偏移量配置
  offset {
    store-type = "mysql"  # mysql 或 file
    commit-interval = 5s
    start-from-latest = true  # true=从最新位置开始（跳过历史），false=从头开始
    enable-snapshot = false  # ⚠️ 未完成功能，生产环境必须 false

    # MySQL 存储配置
    mysql {
      table-name = "cdc_offsets"
    }

    # 文件存储配置
    file {
      path = "./data/offsets"
    }
  }
}

# Pekko 配置
pekko {
  loglevel = "INFO"

  actor {
    provider = "local"
  }

  stream {
    materializer {
      # 流处理缓冲区配置
      max-input-buffer-size = 256
      initial-input-buffer-size = 4
    }
  }
}
